<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.restaurant.admin.member.dao.AdminMemberDao">
	<sql id="searchMember">
		select * from member
		<where>
			<if test="name != ''">
				name like #{name} and
				<if test="phone != ''">
					phone like concat('%',#{phone}) and
					<if test="!weddingdate.toString().substring(0, 10).contains('9999')">
						weddingdate like #{weddingdate} and
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
					<if test="weddingdate.toString().substring(0, 10).contains('9999')">
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
				</if>

				<if test="phone == ''">
					<if test="!weddingdate.toString().substring(0, 10).contains('9999')">
						weddingdate like #{weddingdate} and
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
					<if test="weddingdate.toString().substring(0, 10).contains('9999')">
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
				</if>
			</if>

			<if test="name == ''">
				<if test="phone != ''">
					phone like concat('%',#{phone}) and
					<if test="!weddingdate.toString().substring(0, 10).contains('9999')">
						weddingdate like #{weddingdate} and
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
					<if test="weddingdate.toString().substring(0, 10).contains('9999')">
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
				</if>

				<if test="phone == ''">
					<if test="!weddingdate.toString().substring(0, 10).contains('9999')">
						weddingdate like #{weddingdate} and
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
					<if test="weddingdate.toString().substring(0, 10).contains('9999')">
						<if test="!birthday.toString().substring(0, 10).contains('9999')">
							birthday like #{birthday} and
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
						<if test="birthday.toString().substring(0, 10).contains('9999')">
							<if test="condition != ''">
								condition like #{condition}
								<if test="rank != ''">
								</if>
								<if test="rank == ''">
								</if>
							</if>
							<if test="condition == ''">
								<if test="rank != ''">
									rank like #{rank} and <![CDATA[ condition != '탈퇴' ]]>
								</if>
								<if test="rank == ''">
									<![CDATA[ 1=1 ]]>
								</if>
							</if>
						</if>
					</if>
				</if>
			</if>
		</where>
		order by member_no desc
	</sql>

	<select id="memberList" parameterType="adminMember" resultType="adminMember">
		select * from ( select list.*, rownum as rnum from(
		<include refid="searchMember"></include>
		) list )
		<where>
			<if test="start_row != null and start_row != ''">
				<if test="end_row != null and end_row != ''">
					rnum between #{start_row} and #{end_row}
				</if>
			</if>
		</where>
	</select>

	<!-- 게시물 개수 구하는 쿼리 -->
	<select id="memberListCnt" parameterType="adminMember"
		resultType="int">
		select nvl(count(1),0) from (select list.*, rownum as rnum from (
		<include refid="searchMember"></include>
		) list )
	</select>

	<select id="memberOne" parameterType="int" resultType="adminMember">
		select *
		from member where member_no = #{member_no}
	</select>

	<update id="memberUpdate" parameterType="adminMember">
		update member set
		point=#{point}, rank=#{rank}, b_coupon_no=#{b_coupon_no},
		b_coupon_start=#{b_coupon_start,jdbcType=DATE},
		b_coupon_end=#{b_coupon_end,jdbcType=DATE},
		m_coupon_no=#{m_coupon_no},
		m_coupon_start=#{m_coupon_start,jdbcType=DATE},
		m_coupon_end=#{m_coupon_end,jdbcType=DATE},
		v_coupon_no=#{v_coupon_no},
		v_coupon_start=#{v_coupon_start,jdbcType=DATE},
		v_coupon_end=#{v_coupon_end,jdbcType=DATE}
		where
		member_no =
		#{member_no}
	</update>
</mapper>
